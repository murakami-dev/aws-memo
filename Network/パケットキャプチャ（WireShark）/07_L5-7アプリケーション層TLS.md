- SSL=HTTP over SSL
- 3つの技術でデータを守る
  - 暗号化
  - ハッシュ化：ハッシュ値も改竄すれば良いのでは？と思った
    - ![image](https://user-images.githubusercontent.com/60077121/99600356-9c17a180-2a40-11eb-8ad2-614260f3a30f.png)
  - 証明書：なりすまし防止

## 追記
- 通信の暗号化と証明書による通信相手の検証は同時に行われるが別物ではある
- サーバからクライアントにサーバー証明書を送付。サーバー証明書にはサーバーの公開鍵とデジタル署名が含まれる
  - サーバーの公開鍵で共通鍵の素を暗号化して、TLS通信で使用する共通鍵を配送・共有するので**これはTLS通信のためのアクション**
  - デジタル署名はCAの公開鍵で複合できるか検証するので、**なりすまし防止のアクション**
  - https://dev.classmethod.jp/articles/ssl-introduction-for-aws-client-vpn/

# 共通鍵暗号化方式
  - 暗号化鍵と複合化鍵が同じ。
  - クライアントのサーバが同じ鍵を共有（ここがデメリット）
  
  - 方式
    - ストリーム暗号：迅速。1bitごとに暗号化。脆弱性あり、`RC4`など。使用されない。
    - ブロック暗号：データを一定のブロックに区切って暗号化。`AES`。よく使用される。
    
# 公開鍵暗号化方式
  - 鍵の配送なしに、クライアントからサーバに送る情報を暗号化できる。
  - 方式
    - `RSA`
    - `DH/DHE`（ディーフィー・ヘルマン鍵共有）
    - `ECDH/ECDHE`（楕円曲線ディーフィー・ヘルマン鍵共有）
  ![image](https://user-images.githubusercontent.com/60077121/99601323-8acf9480-2a42-11eb-98d9-44d3c51f8730.png)

# 比較
![image](https://user-images.githubusercontent.com/60077121/99601602-15b08f00-2a43-11eb-8f2c-b2bd4c2e17a1.png)

# SSLは良いとこどり
公開鍵暗号化方式で鍵配送の問題を解決し、共通鍵暗号化方式で暗号化して通信する
![image](https://user-images.githubusercontent.com/60077121/99601805-85267e80-2a43-11eb-9d0a-4d2a7d394c9b.png)

# ハッシュ化・ハッシュ値
**データをハッシュ関数を用いて、ハッシュ化（細切れ）する。一定の長さのデータにギュッとする（ギュッとされたものがハッシュ値）。**
- ハッシュ値を比較してデータが改竄されていないか判断する。

## 性質
- データが1bitでも異なるとハッシュ値は異なる
- データが同じだとハッシュ値も同じ
![image](https://user-images.githubusercontent.com/60077121/99602163-5bba2280-2a44-11eb-85df-6626b25fa619.png)

- ハッシュ値からデータには戻せない
- **データのサイズが異なってもハッシュ値は同じサイズ**
  - `SHA-256`で算出されるハッシュ値の長さは256bit（データが1bitでも1GBでも）

## ハッシュ値の用途
### アプリケーションデータが改竄されていないかチェック
- 送信者はデータと共に「このデータのハッシュ値はこれだよ」と受信者に教える。受信者も同じ計算をして同じハッシュ値が得られるかどうか検証する。
- SSLでは上記に加え、`メッセージ認証コード（MAC）`も使用。ハッシュ化の際に共通鍵の要素も加えることで、相手を認証することができる
![image](https://user-images.githubusercontent.com/60077121/99602876-97092100-2a45-11eb-871e-3329853d9df3.png)

### デジタル証明書の検証
<img width="508" alt="スクリーンショット 2020-11-22 15 21 43" src="https://user-images.githubusercontent.com/60077121/99896738-bff41500-2cd6-11eb-8a6b-ca1523250db8.png">

# まとめ
![image](https://user-images.githubusercontent.com/60077121/99896789-36911280-2cd7-11eb-87de-b3848c6311e5.png)

# SSLのレコードフォーマット、解析に役立つ機能
割愛

# SSL解析
## サーバ証明書について
- 証明書を作る
- CSRとして認証局にリクエスト。下図はCSRに必要な情報
  - ![image](https://user-images.githubusercontent.com/60077121/99896876-ef575180-2cd7-11eb-809c-c5d5512e56c5.png)
- OKならサーバ証明書が貰えるのでサーバにアップロードする（**中間証明書（チェーン）も貰えるので一緒にアップ**）
  - 中間証明書はルート認証局の下部認証局
## SSLハンドシェイク
- TCPの3ウェイハンドシェイクの後に行われる
- 4段階
  - 対応している暗号化方式とハッシュ関数の提示
  - 通信相手の証明
  - 共通鍵の素材の交換
  - 最終確認
![image](https://user-images.githubusercontent.com/60077121/99897061-aa341f00-2cd9-11eb-8f75-a7d6ddfb0d94.png)

## 対応している暗号化方式とハッシュ関数の提示
- `Client Hello`のこと
- 暗号化の方式とハッシュ関数の方式で利用可能なものを提示。この組み合わせを**暗号スイート**という
![image](https://user-images.githubusercontent.com/60077121/99897149-73aad400-2cda-11eb-8655-a5e646753878.png)

## 通信相手の証明
- `Server Hello`,`Certificate`,`Server Hello Done`で成り立つ
![image](https://user-images.githubusercontent.com/60077121/99897172-a94fbd00-2cda-11eb-8c60-617573ea256b.png)

あとは省略
