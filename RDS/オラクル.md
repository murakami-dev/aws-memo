
# 設定項目
## エディションについて
コンソール画面の日本語訳
```
Oracle Enterprise Edition
ミッションクリティカルなアプリケーションと要求の厳しいデータベースワークロードに包括的なハイエンド機能を提供する、効率的で信頼性が高く、安全なデータベース管理システム。

Oracle Standard Edition
最大32個のvCPUをサポートする手頃な価格のフル機能のデータベース管理システム。

Oracle Standard Edition One
最大16個のvCPUをサポートする手頃な価格のフル機能のデータベース管理システム。

Oracle Standard Edition Two
最大16個のvCPUをサポートする手頃な価格のフル機能のデータベース管理システム。 Oracle Database Standard Edition Twoは、StandardEditionおよびStandardEditionOneの代替品です。
```

- オラクルの場合はライセンスのことも考慮`license-included`または`bring-your-own-license`
- ひとつのパラメータグループを複数のインスタンスに使用することや、逆にインスタンスごとに個別のパラメータグループを作成することも可能
- オプショングループも上記と同様

## バージョン
[Oracle データベースエンジンのリリースノート](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Appendix.Oracle.RU-RUR.19.0.0.0.html)
- 例：`バージョン 19.0.0.0.ru-2020-07.rur-2020-07.r1`は`パッチ 31281355: Database Release Update 19.8.0.0.200714`を含んでいる。→Oracle19.8.0.0といえばコレ。

- [Amazon RDS for Oracle のよくある質問](https://aws.amazon.com/jp/rds/oracle/faqs/)
>Q: Oracle 用にどのような Amazon RDS DB エンジンバージョンがあり、Oracle パッチセットにどのように関連付けられますか?
Oracle 用の Amazon RDS DB エンジンバージョンは次のように構成されています。
Oracle 用 DB Engine バージョン= X.Y.Z
>X=メジャーバージョン（例: 11.2）、Y=リリースレベル（例: 0.2）、Z=リリースシリーズのバージョン番号（例: V2）。例えば、Oracle 用 DB Engine バージョンは 11.2.0.2.v2 のようになります。
>Oracle は、四半期ごとにサポートされているリリースレベルで Database Patch Set Updates (PSU) をリリースします (例: 11.2.0.2.1)。PSU には、セキュリティの修正と Oracle が推奨するセキュリティ以外の追加の修正が含まれています。
>Amazon RDS DB Engine バージョンは、ベースラインとして指定された PSU で構築されており、それ以外の追加の修正が含まれている場合があります。
>Amazon RDS では、メジャーバージョンまたはリリースレベルが変更されると、バージョン変更が メジャーであると判断されます。例: 11.2.0.2.Z -> 11.2.0.4.Z.同じリリースでバージョン番号が変更されていれば、バージョン変更は マイナーであると判断されます。例: 11.2.0.2.v2 -> 11.2.0.2.v3 の場合。
Amazon RDS for Oracle がサポートしているメジャーバージョンの最新リストについては、 こちらのドキュメントをご覧ください。


## 主な設定
- DB インスタンス識別子:DB インスタンスの名前を入力します。この名前は、AWS アカウントが現在の AWS リージョンで所有しているすべての DB インスタンスにおいて一意である必要があります。
- マスターユーザ名とパスワード

## DB インスタンスサイズ
- db.t3.smallなど。cpu,メモリ(Gib RAM),EBS(Mbps)

## ストレージ
- タイプ
  - gp2
    - [Tips：RDSでのIOクレジットバランスの考え方（汎用SSDボリューム）](https://dev.classmethod.jp/articles/rds_gp2_iocreditbarance/)
  - プロビジョンドIOPS
  - マグネティック
- ストレージ割り当て(GiB)
- 自動スケーリング、最大ストレージ
  - [【DBのディスクサイズ管理が簡単に】RDSのストレージがストレージの自動スケーリングをサポートしました！](https://dev.classmethod.jp/articles/rds-storage-auto-scaling/)
  - ストレージ割り当て20GiBで最大ストレージしきい値1,000GiBの場合、20の10%<5GiBのため、スケーリングする容量は5GiB
  - >追加のストレージは、次のうちいずれか大きい方の増分です。/5 GiB/現在割り当てられているストレージの 10%
  

## 可用性と耐久性
- マルチAZかどうか

## 接続
- VPC
- サブネットグループ（必ずAZをまたぐように設定しないとダメ）
- SG
- AZ（マルチAZなしを選んだ場合のみ選択する）
- port`1521`

# 追加設定
## パラメータグループ
- https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html
`DB エンジンの設定を管理するには、DB インスタンスをパラメータグループに関連付けます。`

- パラメータグループを特に指定せずRDS作成するとデフォルトのパラメータグループが適用されるが、これは後から変更できず、変更するにはパラメータグループの変更（RDS再起動有）が必要になる
- [RDSのデフォルトパラメータグループの罠](https://qiita.com/ssssasaki/items/f4ab5aacaf1b724ffc50)
- [Amazon RDS DB パラメーターグループの値を変更する方法を教えてください。](https://aws.amazon.com/jp/premiumsupport/knowledge-center/rds-modify-parameter-group-values/)
- [DB パラメータグループのパラメータの変更](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_WorkingWithParamGroups.html#USER_WorkingWithParamGroups.Modifying)
```
ユーザー定義の DB パラメータグループのパラメータ値は変更できますが、デフォルトの DB パラメータグループのパラメータ値を変更することはできません。
```

- やむだで作成するとデフォルトではないグループが適用されるが、内容はデフォルトのパラメータグループと同じ
![image](https://user-images.githubusercontent.com/60077121/98461421-4b59aa80-21ef-11eb-9a6d-c35464b969f6.png)
![image](https://user-images.githubusercontent.com/60077121/98461557-6842ad80-21f0-11eb-903d-0993c2dfbef7.png)

### Oracleの初期化パラメータ
https://docs.oracle.com/cd/E96517_01/refrn/initialization-parameter-descriptions.html#GUID-39EA71DD-3C55-49CA-B6CE-2DBEAFCD3076

### Tips:パラメータグループをExcelに出力する方法
- まずはCLIでパラメータをhoge.jsonに書き込む
  - `aws rds describe-db-parameters --db-parameter-group-name mydbparametergroup > hoge.json`
- hoge.jsonをエディタで編集。`ParameterValue`のkeyがある項目を先頭に持ってくる。**これをしないとExcelにしたときに`ParameterValue`の列がなくなる**
- 以下のとおりにする
  - [JSONファイルをExcelに変換](https://qiita.com/afukuma/items/65c6e96bd15b319e160f)

## オプショングループ
- https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_WorkingWithOptionGroups.html
```
Amazon RDS では、新しい DB インスタンスごとに空のデフォルトオプショングループが用意されます。このデフォルトオプショングループを変更することはできませんが、デフォルトオプショングループからその設定を引き継いで新しいオプショングループを作成することはできます。
```
- 例
  - `S3_INTEGRATION`:S3統合。Amazon RDS for Oracle DB インスタンスと Amazon S3 バケットの間でファイルを転送することができます。
  - `Timezone`:Oracle DB インスタンスで使用するシステムのタイムゾーンを変更することができます。

- パラメータグループとオプショングループは後からでも変更可能。ただし動的
![image](https://user-images.githubusercontent.com/60077121/98460610-2e21dd80-21e9-11eb-9fc2-667819bb1cae.png)


## 文字セット
- `AL32UTF8`・・・Unicode 5.0 UTF-8 Universal 文字セット (デフォルト)
- `JA16EUC`・・・EUC 24-bit 日本語
- `JA16SJIS`・・・Shift-JIS 16-bit 日本語
https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Appendix.OracleCharacterSets.html


## バックアップ
(https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html)
- 自動バックアップの有効・無効が選択できる。
- 保持期間（バックアップを保存する期間。デフォルト7日。MAX35日）
- バックアップウィンドウのデフォルトは`13:00–21:00 UTC`。自分で選択することもできる
  - 毎日行われる。頻度の変更は不可のよう。
  - バックアップウィンドウに割り当てられた時間より長い時間がバックアップに必要な場合、ウィンドウが終了した後もバックアップが完了するまでバックアップが継続します。
  - 週 1 回のメンテナンス時間とバックアップウィンドウは重複できません。

- インスタンスの暗号化

## メンテナンス
https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.Maintenance.html
- 週次で行われる
- メンテナンス中はパフォーマンス落ちることがある。**まれにマルチAZフェイルオーバーが必要なことがある**
- マイナーバージョン自動アップグレードの有効化
- メンテナンスウィンドウ

## Performance Insights
- 有効・無効
- 保持期間

## モニタリング
- 詳細モニタリングを有効にするかどうか

## ログ
| RDS for Oracle での呼称  | Oracle Database での呼称 | 内容 |
| ------------- | ------------- | ------------- | 
| audit  | 監査ログ | 監査対応時に必要な情報 |
| trace  | Content Cell  | エラー発生時の情報およびメモリダンプ |
| alert  | アラートログ | データベース個別のイベントとダンプファイル情報など |
| listener  | リスナーログ  | クライアントからの接続要求状況 |

> audit は パラメータグループの audit_trail で出力方法を指定できます。
> DBの場合、データベース・レコードはAUD$表に書き込まれます。
> OSの場合、監査レコードはオペレーティング・システム・ファイルに書き込まれます。
> XMLの場合、監査レコードはオペレーティング・システム・ファイルにXML形式で書き込まれます。
